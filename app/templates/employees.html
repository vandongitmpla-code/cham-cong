{% extends "base.html" %}
{% block title %}Quản lý Nhân viên • HR System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/form_system.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/employees.css') }}">
{% endblock %}

{% block content %}
<div class="section-card">
    <!-- Modern Header -->
    <div class="header-modern">
        <div class="header-content">
            <h1>Nhân Sự</h1>
            <p>Quản lý nhân viên</p>
        </div>
        <a href="{{ url_for('main.add_employee') }}" class="btn-primary-modern">
            <i class="bi bi-person-plus"></i>
            Thêm nhân viên
        </a>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid-modern">
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ employees|length }}</div>
            <div class="stat-label-modern">Tổng nhân viên</div>
        </div>
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ employees|selectattr('att_code')|list|length }}</div>
            <div class="stat-label-modern">Đã có mã chấm công</div>
        </div>
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ employees|selectattr('start_month')|list|length }}</div>
            <div class="stat-label-modern">Đã cập nhật ngày làm</div>
        </div>
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ (employees|length - employees|selectattr('att_code')|list|length) }}</div>
            <div class="stat-label-modern">Chưa có mã chấm công</div>
        </div>
    </div>

    <!-- THAY THẾ TOÀN BỘ PHẦN TABLE HIỆN TẠI BẰNG CODE NÀY -->
{% if employees %}
<div class="modern-table-container">
    <table class="modern-table">
        <thead>
            <tr>
                <th style="width: 200px;">Nhân viên</th>
                <th style="width: 90px;">Thông tin</th>
                <th style="width: 90px;">Hợp đồng</th>
                <th style="width: 90px;">Thời gian</th>
                <th style="width: 100px;">Chấm công</th>
                <th style="width: 100px;">Trạng thái</th>
                <th style="width: 100px;">Thao tác</th>
            </tr>
        </thead>
        <!-- THAY THẾ TOÀN BỘ PHẦN TABLE BODY -->
<tbody>
    {% for emp in employees %}
    <tr>
        <!-- Cột 1: Nhân viên - Tên và mã -->
        <td>
            <div class="employee-card-compact">
                <div class="employee-avatar-compact">
                    {{ emp.name[0] if emp.name }}
                </div>
                <div class="employee-info-compact">
                    <div class="employee-name-compact truncate">{{ emp.name }}</div>
                    <div class="employee-code-compact truncate">#{{ emp.code }}</div>
                </div>
            </div>
        </td>

        <!-- Cột 2: Thông tin - Tổ và phòng ban -->
        <td>
            <div class="department-info-compact">
                <div class="team-name-compact truncate">{{ emp.team or '--' }}</div>
                <div class="department-name-compact truncate">{{ emp.department or '--' }}</div>
            </div>
        </td>

        <!-- Cột 3: Hợp đồng - Loại hợp đồng -->
        <td>
            <span class="badge-compact badge-contract-compact truncate">
                {{ emp.contract_type or '--' }}
            </span>
        </td>

        <!-- Cột 4: Thời gian - Ngày làm và bảo hiểm -->
        <td>
            <div class="date-display-compact">
                <div class="date-item-compact">
                    <span class="date-label-compact">Làm:</span>
                    <span class="date-value-compact">
                        {% if emp.start_month %}
                            {{ emp.start_month[5:7] }}/{{ emp.start_month[:4] }}
                        {% else %}
                            --
                        {% endif %}
                    </span>
                </div>
                <div class="date-item-compact">
                    <span class="date-label-compact">BH:</span>
                    <span class="date-value-compact">
                        {% if emp.insurance_start_month %}
                            {{ emp.insurance_start_month[5:7] }}/{{ emp.insurance_start_month[:4] }}
                        {% else %}
                            --
                        {% endif %}
                    </span>
                </div>
            </div>
        </td>

        <!-- Cột 5: Chấm công - Mã chấm công -->
        <td>
            <form action="{{ url_for('main.update_att_code', emp_id=emp.id) }}" method="post" class="input-group-compact">
                <input type="text" name="att_code" value="{{ emp.att_code or '' }}" 
                       class="input-compact" placeholder="Mã">
                <button type="submit" class="btn-attendance-compact">
                    <i class="bi bi-check-lg"></i>
                </button>
            </form>
        </td>

        <!-- Cột 6: Trạng thái - Trạng thái làm việc -->
        <td>
            <span class="badge-compact badge-active-compact">
                <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i>
                Đang làm
            </span>
        </td>

        <!-- Cột 7: Thao tác - Nút sửa/xóa -->
        <td>
            <div class="actions-compact">
                <a href="{{ url_for('main.edit_employee', emp_id=emp.id) }}" class="btn-compact btn-edit-compact">
                    <i class="bi bi-pencil"></i>
                    Sửa
                </a>
                <form action="{{ url_for('main.delete_employee', emp_id=emp.id) }}" method="post" style="display: inline;">
                    <button type="submit" class="btn-compact btn-delete-compact" 
                            onclick="return confirm('Xóa {{ emp.name }}?')">
                        <i class="bi bi-trash"></i>
                        Xóa
                    </button>
                </form>
            </div>
        </td>
    </tr>
    {% endfor %}
</tbody>
    </table>
</div>
{% else %}
    <!-- Modern Empty State -->
    <div class="empty-state-modern">
        <div class="empty-icon-modern">
            <i class="bi bi-people"></i>
        </div>
        <h2 class="empty-title-modern">Chưa có nhân viên</h2>
        <p class="empty-description-modern">
            Bắt đầu xây dựng đội ngũ của bạn bằng cách thêm nhân viên đầu tiên.
        </p>
        <a href="{{ url_for('main.add_employee') }}" class="btn-primary-modern">
            <i class="bi bi-person-plus"></i>
            Thêm nhân viên đầu tiên
        </a>
    </div>
    {% endif %}
</div>

<!-- Floating Action Button -->
<a href="{{ url_for('main.add_employee') }}" class="fab" title="Thêm nhân viên mới">
    <i class="bi bi-plus-lg"></i>
</a>

{% endblock %}