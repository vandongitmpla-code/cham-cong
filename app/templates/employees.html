{% extends "base.html" %}
{% block title %}Quản lý Nhân viên • HR System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/form_system.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/employees.css') }}">
{% endblock %}

{% block content %}
<div class="section-card">
    <!-- Modern Header -->
    <div class="header-modern">
        <div class="header-content">
            <h1>Nhân sự</h1>
            <p>Quản lý đội ngũ nhân viên của bạn</p>
        </div>
        <a href="{{ url_for('main.add_employee') }}" class="btn-primary-modern">
            <i class="bi bi-person-plus"></i>
            Thêm nhân viên
        </a>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid-modern">
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ employees|length }}</div>
            <div class="stat-label-modern">Tổng nhân viên</div>
        </div>
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ employees|selectattr('att_code')|list|length }}</div>
            <div class="stat-label-modern">Đã có mã chấm công</div>
        </div>
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ employees|selectattr('start_month')|list|length }}</div>
            <div class="stat-label-modern">Đã cập nhật ngày làm</div>
        </div>
        <div class="stat-card-modern">
            <div class="stat-number-modern">{{ (employees|length - employees|selectattr('att_code')|list|length) }}</div>
            <div class="stat-label-modern">Chưa có mã chấm công</div>
        </div>
    </div>

    {% if employees %}
    <!-- Modern Table -->
    <div class="modern-table-container glass-effect">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>Nhân viên</th>
                    <th>Thông tin</th>
                    <th>Hợp đồng</th>
                    <th>Thời gian</th>
                    <th>Chấm công</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                <tr>
                    <!-- Employee Card -->
                    <td>
                        <div class="employee-card-modern">
                            <div class="employee-avatar-modern">
                                {{ emp.name[0] if emp.name }}
                            </div>
                            <div class="employee-info-modern">
                                <div class="employee-name-modern">{{ emp.name }}</div>
                                <div class="employee-code-modern">#{{ emp.code }}</div>
                            </div>
                        </div>
                    </td>

                    <!-- Department Info -->
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <span style="font-weight: 600; color: var(--text-primary);">{{ emp.team or 'Chưa cập nhật' }}</span>
                            <span style="font-size: 0.8rem; color: var(--text-tertiary);">{{ emp.department or 'Chưa cập nhật' }}</span>
                        </div>
                    </td>

                    <!-- Contract Type -->
                    <td>
                        <span class="badge-modern badge-contract">
                            {{ emp.contract_type or 'Chưa cập nhật' }}
                        </span>
                    </td>

                    <!-- Dates -->
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary);">Bắt đầu làm</div>
                                <div style="font-weight: 600; font-size: 0.85rem;">
                                    {% if emp.start_month %}
                                        {{ emp.start_month[5:7] }}/{{ emp.start_month[:4] }}
                                    {% else %}
                                        --
                                    {% endif %}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary);">Bảo hiểm</div>
                                <div style="font-weight: 600; font-size: 0.85rem;">
                                    {% if emp.insurance_start_month %}
                                        {{ emp.insurance_start_month[5:7] }}/{{ emp.insurance_start_month[:4] }}
                                    {% else %}
                                        --
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>

                    <!-- Attendance Code -->
                    <td>
                        <form action="{{ url_for('main.update_att_code', emp_id=emp.id) }}" method="post" class="input-group-modern">
                            <input type="text" name="att_code" value="{{ emp.att_code or '' }}" 
                                   class="input-modern" placeholder="Mã máy" style="width: 100px;">
                            <button type="submit" class="btn-attendance" title="Lưu mã chấm công">
                                <i class="bi bi-check-lg"></i>
                            </button>
                        </form>
                    </td>

                    <!-- Status -->
                    <td>
                        <span class="badge-modern badge-active">
                            <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i>
                            Đang làm việc
                        </span>
                    </td>

                    <!-- Actions -->
                    <td>
                        <div class="actions-modern">
                            <a href="{{ url_for('main.edit_employee', emp_id=emp.id) }}" class="btn-modern btn-modern-edit">
                                <i class="bi bi-pencil"></i>
                                Sửa
                            </a>
                            <form action="{{ url_for('main.delete_employee', emp_id=emp.id) }}" method="post" style="display: inline;">
                                <button type="submit" class="btn-modern btn-modern-delete" 
                                        onclick="return confirm('Bạn có chắc muốn xóa {{ emp.name }}?')">
                                    <i class="bi bi-trash"></i>
                                    Xóa
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <!-- Modern Empty State -->
    <div class="empty-state-modern">
        <div class="empty-icon-modern">
            <i class="bi bi-people"></i>
        </div>
        <h2 class="empty-title-modern">Chưa có nhân viên</h2>
        <p class="empty-description-modern">
            Bắt đầu xây dựng đội ngũ của bạn bằng cách thêm nhân viên đầu tiên.
        </p>
        <a href="{{ url_for('main.add_employee') }}" class="btn-primary-modern">
            <i class="bi bi-person-plus"></i>
            Thêm nhân viên đầu tiên
        </a>
    </div>
    {% endif %}
</div>

<!-- Floating Action Button -->
<a href="{{ url_for('main.add_employee') }}" class="fab" title="Thêm nhân viên mới">
    <i class="bi bi-plus-lg"></i>
</a>

<style>
.section-card {
    background: transparent;
    padding: 0;
    box-shadow: none;
    border: none;
}
</style>
{% endblock %}